# PHN14-51 Support - Technical Documentation

## Overview

The **Acer Predator Helios Neo 14 (PHN14-51)** has been added to Linuwu-Sense with full support for all available hardware features. This document details the technical implementation.

## Supported Features

| Feature | Status | Implementation |
|---------|--------|----------------|
| Mode Switch Button | ✅ Working | Standard WMI event handling |
| Thermal Profiles | ✅ All 5 modes | Quiet, Balanced, Performance, Turbo, Eco |
| Eco Mode | ✅ Auto-enabled | Switches to Eco on battery power |
| Fan Speed (RPM) | ✅ EC Direct Read | Custom EC implementation |
| Fan Control | ✅ AUTO mode | System-managed fan speeds |
| Keyboard RGB | ✅ 4-zone | Standard Predator V4 support |

## Hardware Differences vs PHN16-71

The PHN14-51 uses different hardware interfaces compared to the 16-inch model:

### Sensor Reading
- **PHN16-71**: Uses WMI methods for sensor data
- **PHN14-51**: Sensor data stored directly in EC (Embedded Controller)

### Why EC Direct Reading?

WMI sensor reading (`ACER_WMID_CMD_GET_PREDATOR_V4_SENSOR_READING`) returns `0x0` for all sensors on PHN14-51, even though the BIOS reports sensors are available. Investigation revealed that fan RPM data is accessible via EC memory instead.

## Technical Implementation

### EC Offset Discovery

Through reverse engineering, we identified fan RPM data in EC memory:

```c
#define ACER_PHN14_EC_FAN_CPU_LSB	0x13  /* CPU fan low byte */
#define ACER_PHN14_EC_FAN_CPU_MSB	0x14  /* CPU fan high byte */
#define ACER_PHN14_EC_FAN_GPU_LSB	0x15  /* GPU fan low byte */
#define ACER_PHN14_EC_FAN_GPU_MSB	0x16  /* GPU fan high byte */
```

Data format: 16-bit little-endian values representing RPM.

### Quirk Entry

```c
static struct quirk_entry quirk_acer_predator_phn14_51 = {
    .predator_v4 = 1,
    .four_zone_kb = 1,
    .phn14_sensors = 1,  /* Enable EC direct reading */
};
```

### EC Reading Function

```c
static int acer_phn14_read_ec_fan(int channel, long *val)
{
    u8 lsb, msb;
    
    /* Read EC bytes */
    ec_read(lsb_offset, &lsb);
    ec_read(msb_offset, &msb);
    
    /* Combine as little-endian 16-bit */
    *val = lsb | (msb << 8);
    
    return 0;
}
```

### Integration into hwmon

The fan reading is integrated into the standard hwmon interface:

```c
case hwmon_fan:
    if (quirks->phn14_sensors) {
        return acer_phn14_read_ec_fan(channel, val);
    }
    /* Standard WMI for other models */
```

## Thermal Profiles

All 5 thermal profiles work correctly:

### On AC Power
1. **Quiet** (`quiet`) - Minimal fan noise
2. **Balanced** (`balanced`) - Balanced performance
3. **Performance** (`balanced-performance`) - High performance
4. **Turbo** (`performance`) - Maximum performance

### On Battery
1. **Eco** (`low-power`) - Power saving mode
2. **Balanced** (`balanced`) - Normal operation

## Mode Switch Button

The physical mode switch button cycles through profiles:
- **On AC**: Quiet → Balanced → Performance → Turbo → Quiet
- **On Battery**: Eco ⇄ Balanced

## Verification

### Check Fan RPM
```bash
sensors
```

Expected output:
```
acer-isa-0ace
Adapter: ISA adapter
fan1:        1388 RPM
fan2:        1530 RPM
```

### Test Thermal Profiles
```bash
# View current profile
cat /sys/firmware/acpi/platform_profile

# Set profile manually
echo performance | sudo tee /sys/firmware/acpi/platform_profile
```

## Limitations

### Temperature Sensors
WMI temperature sensors are not available on PHN14-51. The `tempX` entries will show `0°C`. Use `coretemp` for CPU temperatures instead.

This is a hardware limitation - the BIOS does not expose temperature data via the WMI interface on this model.

## Reverse Engineering Process

1. **EC Access**: Enabled EC debugging with `ec_sys` kernel module
2. **Data Collection**: Dumped EC memory in different thermal modes
3. **Pattern Analysis**: Compared EC dumps to identify changing bytes
4. **Validation**: Verified values matched expected fan speeds (1200-2000 RPM)
5. **Implementation**: Created EC reading functions for PHN14-51

## Future Work

Potential improvements:
- Additional EC offset discovery for other sensors
- Per-application thermal profile automation
- Advanced fan curve customization

## See Also

- [Main README](../README.md) - General installation and usage
- [linuwu_sense.c](../src/linuwu_sense.c) - Full source code
